<style>/*
	::placeholder{
		color:#bbb
	}*/
	html,body{
		height:100%
	}
	body{
		background:#000;/*font-family:arial;line-height:1.5;*/margin:unset
	}
	video,canvas{
		display:block;height:/*calc(*/100%/* - 48px)*/;width:100%
	}
	canvas{
		left:0;position:absolute;top:0
	}/*
	input{
		all:unset;background:#333;display:block;padding:12px 16px;width:calc(100% - 32px)
	}*/
</style>
<input id=isbn placeholder=ISBN style="display:none">
<script src="https://cdn.jsdelivr.net/npm/quagga"></script>
<script>
	const checker={}
	Quagga.init({
		inputStream:{type:"LiveStream",target:document.body},
		constraints:{facingMode:"environment"},
		decoder:{readers:["ean_reader"]} 
	},error=>{
		error?console.log(error):Quagga.start()
	})
	Quagga.onProcessed(result=>{
		if(result?.box===undefined) return
		Quagga.canvas.ctx.overlay.clearRect(0,0,parseInt(Quagga.canvas.dom.overlay.width),parseInt(Quagga.canvas.dom.overlay.height))
		Quagga.ImageDebug.drawPath(result.box,{x:0,y:1},Quagga.canvas.ctx.overlay,{color:"blue",lineWidth:2})
	})
	Quagga.onDetected(async result=>{
		checker[result.codeResult.code]=(checker[result.codeResult.code]||0)+1
		//isbn.value=checker[result.codeResult.code]
		if(checker[result.codeResult.code]!=0x10) return
		//result.codeResult.code="9784910063041"
		const response=await fetch("https://www.googleapis.com/books/v1/volumes?q=isbn:"+result.codeResult.code)
		const json=await response.json()
		if(confirm("図書の内容は以下ですか?\n\nISBN: "+result.codeResult.code+"\n題名: "+json.items[0].volumeInfo.title+"\n著者: "+json.items[0].volumeInfo.authors.join("、"))){
			open("https://docs.google.com/forms/d/e/1FAIpQLSdu_2j4p3ubst0eoFRZaHoSZEbFB2SJkvzbSlxkh6qJXCMcFw/viewform?usp=pp_url&entry.772749012="+result.codeResult.code)
		}
		for(const key in checker) delete checker[key]
	})
</script>