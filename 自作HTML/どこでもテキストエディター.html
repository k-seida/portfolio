<link href=style.css rel=stylesheet>
<meta content=width=device-width name=viewport>
<style>
	html,body{height:calc(100% - 16px)}
	textarea{height:calc(100% - 216px)}
</style>
<title>どこでもテキストエディター</title>
<button id=selectButton>ファイルを選択</button>
<textarea id=text placeholder=テキスト></textarea>
<button id=htmlPreviewButton>HTMLとしてプレビュー</button>
<button id=saveButton>保存</button>
<script type=module>
	let fileName=""
	selectButton.onclick=async()=>{
		const input=document.createElement("input")
		input.type="file"
		input.click()
		{
			const{promise,resolve}=Promise.withResolvers()
			input.addEventListener("change",resolve)
			await promise
		}
		fileName=input.files[0].name
		const fileReader=new FileReader
		fileReader.readAsText(input.files[0],prompt("読み込まれるファイルの文字コードを入力してください。\nキャンセルされた場合は、UTF-8で読み込みます。","sjis"))
		{
			const{promise,resolve}=Promise.withResolvers()
			fileReader.addEventListener("load",resolve)
			await promise
		}
		text.value=fileReader.result
	}
	htmlPreviewButton.onclick=()=>{
		open(URL.createObjectURL(new Blob([text.value],{type:"text/html"})))
	}
	saveButton.onclick=function onclick(){
		const newFileName=prompt("ファイル名を入力してください。",fileName)
		if(newFileName); else return
		const anchor=document.createElement("a")
		anchor.download=newFileName
		anchor.href=URL.createObjectURL(new Blob([text.value]))
		anchor.click()
	}
</script>