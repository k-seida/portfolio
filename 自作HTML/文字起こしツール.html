<link href=style.css rel=stylesheet>
<meta content=width=device-width name=viewport>
<style>
	html,body{height:calc(100% - 16px)}
	textarea{height:calc(100% - 152px)}
</style>
<title>文字起こしツール</title>
<textarea id=result placeholder=結果 readonly></textarea>
<button disabled id=copyButton>コピー</button>
<button disabled id=saveButton>メモを保存</button>
<script type=module>
	copyButton.onclick=async()=>{
		await navigator.clipboard.writeText(result.value)
		event.target.innerText="コピー済み"
	}
	saveButton.onclick=()=>{
		const anchorElement=document.createElement("a")
		anchorElement.download=new Date().toLocaleString("sv").replaceAll(/^\d\d|-|:|\d\d$/g,"")+" メモ.txt"
		anchorElement.href=URL.createObjectURL(new Blob([result.value]))
		anchorElement.click()
	}
	const previousTexts=[]
	let currentTexts
	const recognition=new webkitSpeechRecognition
	recognition.continuous=true
	recognition.interimResults=true
	recognition.lang="ja"
	recognition.onend=()=>{
		if(currentTexts) previousTexts.push(...currentTexts)
		event.target.start()
	}
	recognition.onresult=event=>{
		currentTexts=[...event.results].map(([{transcript}])=>transcript)
		result.value=[...previousTexts,...currentTexts].map(text=>"　"+text).join("\n")
		if(!copyButton.disabled) return
		copyButton.disabled=false
		copyButton.innerText="コピー"
		saveButton.disabled=false
	}
	recognition.start()
</script>