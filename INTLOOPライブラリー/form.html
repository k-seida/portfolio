<meta content=width=device-width name=viewport>
<link href=style.css rel=stylesheet>
<style>
	*{
		line-height:calc(1em + 16px);margin:unset
	}
	body{
		font-family:baseline,arial,yu gothic,sans-serif;font-kerning:none;padding:8px 16px;
		margin-left:auto;margin-right:auto;max-width:calc(640px - 32px)
	}
	button,input{
		all:unset;background:#ddd;margin-top:8px;margin-bottom:8px;padding:8px 16px;width:calc(100% - 32px);text-align:center
	}
	button:not(:disabled){
		cursor:pointer
	}
	input[type=date]{
		display:inline-block;height:calc(1em + 16px)
	}
	input[type=radio]{
		display:none
	}
	button,label:has(input:checked){
		background:#000;color:#fff;font-weight:bold;text-align:center
	}
	label:not(:has(input)){
		font-weight:bold
	}
	label:has(input){
		background:#ddd;cursor:pointer;flex-grow:1;margin-top:8px;margin-bottom:8px;padding:8px 16px;text-align:center
	}
	:disabled{
		opacity:calc(2/3)
	}
	#flex{
		display:flex;column-gap:16px
	}
</style>
<form id=form>
	<label>ISBN 上12桁</label>
	<input id=digits readonly type=number>
	<label>氏名</label>（姓名間に空白を入れてください）
	<input id=userName>
	<label>申請種別</label>
	<div id=flex>
		<label><input name=type value=貸出 type=radio>貸出</label>
		<label><input name=type value=延長 type=radio>延長</label>
		<label><input name=type value=返却 type=radio>返却</label>
	</div>
	<label class=貸出>貸出日</label>
	<input class=貸出 id=date type=date>
	<button disabled id=submit>申請</button>
</form>
<script type=module>
	digits.value=new URL(location).searchParams.get("digits")
	date.value=new Date().toLocaleDateString("sv")

	oninput=()=>{
		for(const element of document.querySelectorAll(".貸出")){
			element.style.display=form.type.value=="貸出"?"":"none"
		}
		submit.disabled=!digits.value || !form.type.value || !/\S+\s+\S+/.test(userName.value)
	}
	oninput()

	submit.onclick=async()=>{
		event.preventDefault()
		submit.disabled=true
		const url=new URL("https://script.google.com")
		url.pathname="macros/s/AKfycbx2Iksqz5JihaJKVJakdnP0E6K_15N4bzuEAvXGVaVFmA63BhQVw6pt6VuvZWYzlUWh/exec"
		const payloadSource={digits:digits.value,type:form.type.value,date:date.value,userName:userName.value}
		const response=await fetch(url,{method:"post",body:JSON.stringify(payloadSource)})
		alert(await response.text())
	}
</script>